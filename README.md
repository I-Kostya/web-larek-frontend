# Проектная работа "Веб-ларек"

### Описание проекта
Проект представляет собой интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. /
Для проекта была спроектирована архитектура с разделением кода на слои согласно парадигме MVP с использованием Событийно Ориентированного Программирования

### Стек: 
Стек: HTML, SCSS, TS, Webpack

### Макет
Ссылка на [макет](https://www.figma.com/design/2Tl8AVAWtKp1bWzdxNNJeB/%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA?node-id=0-1&node-type=canvas&t=xXICsFZLs4W4b1pj-0)

### Расположение
Посмотреть на проект можно по адресу [https://i-kostya.github.io/web-larek-frontend/](https://i-kostya.github.io/web-larek-frontend/)

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```ts
interface IProduct {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  price: number | null;
}
```

Интерфейс описывает данные, которые приходят с сервера

```ts
interface IGetProductsResponse {
  total: number;
  items: IProduct[];
}
```

Интерфейс описывает данные частей приложения: каталог, превью, корзина, форма заказа

```ts
interface IAppState {
  catalog: IProduct[];
  basket: string[];
  preview: string | null;
  order: IOrder;
  total: string | number;
  loading: boolean;
}
```

Данные формы заказа

```ts
interface IOrderForm {
  payment: string;
  address: string;
  email: string;
  phone: string;
  total: string | number;
}
```

Данные покупки

```ts
interface IOrder extends IOrderForm {
  items: string[];
}
```

Интерфейс успешного заказа

```ts
interface IOrderResult {
  id: string;
}
```

Тип категорий продуктов

```ts
type TCategory =
  | 'софт-скил'
  | 'другое'
  | 'дополнительное'
  | 'кнопка'
  | 'хард-скил';
```

Тип данных, находящихся в корзине

```ts
type TBasketItem = Pick<IProduct, 'title' | 'price' | 'id'>;
```

Тип данных, при просмотре продукта

```ts
type TPreviewItem = Pick<IProduct, 'title' | 'image' | `description' | 'price' | 'id'>;
```

Тип формы оплаты

```ts
type TPaymentForm = Pick<IOrderForm, 'payment' | 'address'>;
```

Тип формы контактов

```ts
type TContactsForm = Pick<IOrderForm, 'email' | 'phone'>;
```

Тип ошибки заказа

```ts
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Хранит основные поля и методы, необходимые при работе с сервером.\
В конструктор передается базовый url (baseUrl) и опции запроса (options).

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс Model

Абстрактный класс дженерик, обощающий в себе конструктор и метод привязки события.

Конструктор:

- принимает на вход объект данных неявного типа и объект события типа IEvent.
- производит слияние входящего объекта с родительским

Методы:

- `emitChanges` — регистрирует входящее событие в EventEmitter

#### Класс Component

Абстрактный класс дженерик, обобщающий в себе конструктор и основные методы работы с компонентами отображения.

Конструктор:
-принимает на вход `container` типа HTMLElement

Методы:

- `toggleClass` - метод переключения классов
- `setText` - метод установки текстового содержимого
- `setDisabled` - метод смены статуса блокировки
- `setHidden` - метод скрыть
- `setVisible` - метод показать
- `setImage` - метод установить изображения с альтернативным текстом
- `render` - метод возвращения корневого DOM-элемента

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс `LarekApi`

Основной класс для работы с сервером в проекте.\
Расширяет базовый класс `Api` по интерфейсу `ILarekAPI`.

```ts
interface ILarekAPI {
  getProductList: () => Promise<IProduct[]>;
  orderProducts: (order: IOrder) => Promise<IOrderResult>;
}
```

Поля класса:

- cdn - хранит входящий url

Конструктор:

- принимает и передает в родительский конструктор Api поля baseUrl и options
- принимает и сохраняет входящий url запроса в cdn

Методы:

- getProductList — метод получения списка товаров с сервера
- orderProducts — метод отправки данных заказа на сервер

<!-- #### Класс `ProductItem`

Принимает и хранит в себе данные товара: идентификатор, заголовок, описание, категория, изображение, цена.\
Расширяет базовый абстрактный класс `Model<T>` по интерфейсу `IProduct`.

Поля класса:

- `id` - идентифекатор продукта
- `title` - название продукта
- `description` - описание продукта
- `category` - категория рассматриваемого продукта
- `image` - изображение описывающее продукт
- `price` - цена продукта -->

#### Класс AppState

Содержит в себе все основные группы данных страницы и методы работы с ними.\
Расширяет базовый абстрактный класс `Model<T>` по интерфейсу `IAppState`.

Поля класса:

- `catalog` - для данных списка товаров
- `preview` - для данных предпросмотра товара
- `basket` - для данных корзины покупок
- `order` - для данных заказа, который отправляется на сервер
- `formErrors` - для данных ошибок формы

Методы:

- `setCatalog` - установить каталог товаров
- `setPreview`- установить выбранный продукт в предпросмотр
- `getPreviewButton` - получение состояния кнопки
- `addProductToBusket` - добавить продукт в корзину
- `removeProductFromBusket` - убрать один продукт из корзины
- `clearBasket` - очистить данные корзины
- `clearOrder` - очистить данные заказа
- `get total` - получить финальную сумму заказа
- `updateOrder` - обновить данные заказа
- `setOrderField` - устанавливает данные в форму заказа
- `setContactsField` - устанавливает данные в форму контактов
- `validateOrder` - провести валидацию формы заказа
- `validateContacts` - провести валидацию формы контактов

### Слой представления

Все классы представления отвечают за отображение данных внутри контейнера (DOM-элемент).

#### Класс Page

Класс отвечает за отображение всех элементов страницы: корзины, счетчика корзины, каталога товаров.\
Расширяет базовый абстрактный класс `Component<T>` по интерфейсу `IPage`.

```ts
interface IPage {
  counter: number;
  catalog: number;
  locked: boolean;
}
```

Поля класса:

- `_counter` - отвечает за счетчик корзины
- `_catalog` - отвечает за хранение разметки каталога карточек
- `_wrapper` - отвечает за хранение разметки обёртки страницы
- `_buttonBasket` - отвечает за хранение разметки кнопки корзины

Конструктор:

- принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`
- передает `container` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает на кнопку корзины `_buttonBasket` слушатель события `click`, при котором регистрируется событие `basket:open`

Методы класса:

- `set catalog` - отвечает за установку каталога
- `set counter` - отвечает за установку счетчика
- `set isLocked` - отвечает за блокироку прокрутки страницы

#### Класс Card

Класс отвечает за отображение данных карточки товара в каталоге.\
Расширяет базовый абстрактный класс `Component<T>` по интерфейсу `ICard`.

```ts
interface ICard {
  id: string;
  title: string;
  category: string;
  image: string;
  price: number;
  text: string;
  button?: string;
}
```

Поля:

- `_title` - отвечает за храненине названия карточки
- `_category` - хранит разметку категории карточки
- `_image` - хранит разметку изображения карточки
- `_price` - хранит разметку цены карточки

Конструктор:

- принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`.
- передает `container` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает слушатель клика

Методы:

- `set title` - устанавливает название товара
- `set category` - устанавливает данные категории товара
- `set image` - устанавливает данные изображение
- `set price` - устанавливает данные цены товара

#### Класс CardPreview

Класс отображает превью выбранного товара.\
Расширяет класс `Card`.

Поля:

- `_text` - хранит разметку описания
- `_button` - хранит разметку кнопки "В корзину"

Конструктор:

- принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`.
- передает `container` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает слушатель клика

Методы:

- `set text` - установка содержимого описания
- `set button`- установка содержимого кнопки

#### Класс CardBasket

Класс отвечает за отображение данных товара в корзине.\
Расширяет базовый абстрактный класс `Component<T>` по типу `ICardBasket`.

```ts
interface ICardBasket {
  title: string;
  price: number;
  index: number;
}
```

Поля:

- `_title` - хранит разметку названия товара
- `_price` - хранит разметку цены товара
- `_button` - хранит разметку кнопки товара
- `_index` - хранит разметку индекса товара

Конструктор:

- принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`.
- передает `container` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает слушатель клика

Методы:

- `set index` - установка данных индекса
- `set title` - установка данных названия
- `set price` - установка данных цены

#### Класс Modal

Принимает разметку модального окна, отвечает за отображение содержимого таких элементов (модальных окон).\
Расширяет базовый абстрактный класс `Component<T>` по интерфейсу `IModalData`.

```ts
interface IModalData {
  content: HTMLElement;
}
```

Поля:

- `_content` - отвечает за храненеие разметки контента модального окна
- `_closeButton` - отвечает за хранение кнопки закрытия модального окна

Конструктор:

- принимает `сontainer` с типом HTMLElement и `event` с типом IEvent
- передает `container` в родительский конструктор
- записывает нужные данные в поля класса
- вешает слушатель клика

Методы:

- `set сontent` - устанавливает содержимое модального окна
- `open` - открывает модальное окно
- `close` - закрывает модально окно
- `render` - отрисовывает контент и открывает модалку

#### Класс Basket

Класс отвечает за отображение корзины: кнопки сабмита, полной стоимости.\
Расширяет базовый абстрактный класс `Component<T>` по типу `IBasketView`.

```ts
interface IBasketView {
  list: HTMLElement[];
  total: number;
}
```

Поля:

- `_list` - хранит разметку листа карточек (товаров)
- `_total` - хранит разметку обертки полной стоимости
- `_button` - хранит разметку кнопки "оформить"

Конструктор:

- принимает `container` типа HTMLElement и `event` типа IEvent
- записывает данные в поля
- передает `container` в родительский класс (конструктор)
- вешает слушатель на кнопку сабмита

Методы:

- `set list` - устанавливает карточки в разметку
- `set total` - устанавливает финальную сумму

#### Класс Form

Класс отвечает за обертку форм с данными, работу с ними.\
Расширяет базовый абстрактный класс `Component<T>` по интерфейсу `IForm`.

```ts
interface IForm {
  errors: string[];
  valid: boolean;
}
```

Поля:

- `_errors` - хранит разметку поля ошибок в инпутах
- `_submit` - хранит разметку кнопки сабмита

Конструктор:

- принимает `сontainer` с типом HTMLElement и `event` с типом IEvent
- передает `container` в родительский конструктор
- записывает нужные данные в поля класса
- добавляет слушатели на сабмит и инпуты

Методы:

- `onInputChange` - фиксирует изменения в инпутах
- `set valid` - устанавливает валидность формы
- `set errors` - устанавливает ошибки
- `render` - отрисовывает форму

#### Класс Order

Отвечает за первое модальное окно оплаты заказа, расширяет класс Form<TPaymentForm>.

Поля:

- `_buttons` — хранит разметку кнопок формы оплаты

Конструктор:

- принимает `container:HTMLElement` и объект `event:IEvent`
- передает `container`, `events` в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает слушатель клика

Методы

- `set payment` — устанавливает класс активности на кнопку типа оплаты
- `set address` — устанавливает значение поля адрес

#### Класс Contacts

Отвечает за второе модальное окно оплаты заказа, расширяет класс Form<TContactsForm>.

Конструктор:

- принимает `container:HTMLElement` и объект `event:IEvent`
- ередает `container`, `events` в родительский конструктор

Методы:

- `set email` - устанавливает значение инпута почты
- `set phone` - устанавливает значение инпута телефона

#### Класс Success

Класс нужен для отображения данных успешного заказа.\
Расширяет базовый абстрактный класс `Component<T>` по интерфесу `ISuccess`

```ts
interface ISuccess {
  total: number;
}
```

Поля:

- `_total` - разметка общей суммы товаров
- `_close` - разметка кнопки закрытия окна

Конструктор:

- принимает `container:HTMLElement` и `actions:ISuccessActions`.
- передает `container` в родительский конструктор
- сохраняет необходимые данные в поля класса
- вешает слушатель на кнопку `_close`

Методы:

- `set total` - установка полной стоимости

### Взаимодействие компонентов (Presenter)

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts\
В index.ts сначала создаются экземпляры событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts\

Список всех событий, генерируемых в системе:

- `catalog:changed` - изменение массива товаров
- `product:select` - изменение открываемого в модальном окне товара
- `product:addToBasket` - добавление товара в корзину
- `basket:open` - открытие корзины
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `product:select` - выбор товара для просмотра в модальном окне
- `preview:changed` - изменение данных товара для показа в модальном окне предпросмотра
- `order:open` - подтверждение товаров в корзине
- `order:change` - изменение данных в форме с информацией заказа
- `contacts:input` - изменение данных в форме с контактами пользователя
- `order:submit` - сохранение данных о заказе в форме
- `contacts:submit` - сохранение данных о контактах пользователя в форме
- `order:ready` - событие после выполнения валидации формы заказа
- `contacts:ready` - событие после выполнения валидации формы контактов пользователя
